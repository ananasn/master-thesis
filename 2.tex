 \def\figureautorefname{рис.}
  \def\equationautorefname{формуле}
\chapter{Пользовательский графический интерфейс систем управления технологическим оборудованием}
\section{Виды пользовательского интерфейса систем управления технологическим оборудованием и~его основные функции}
Любая система управления технологическим оборудованием состоит из трех основных частей:
\begin{itemize}
\item ядро системы управления;
\item программируемый логический контроллер;
\item человеко-машинный интерфейс.
\end{itemize}

Обычно человеко-машинный интерфейс в~технологическом оборудовании реализуется двумя способами: {\it аппаратным} и~{\it программным}.

Классическая реализация аппаратной стойки управления включает в~себя множество кнопок, регуляторов и~других физических элементов~(\autoref{fig:fanuc}). \textls[-25]{При этом все чаще стали получать распространение стойки, которые имеют в~своем составе сенсорные экраны~(\autoref{fig:kse}), позволяющие в~разы сократить количество физических элементов управления, оставив только самые критически важные, например, кнопку аварийного останова.}

\begin{figure}[h!]
    \centering
    \includegraphics[width=.9\textwidth]{019_FANUC-0iTD.jpg}
    \caption[Стойка FANUC Series 0i-TD]
            {Стойка FANUC Series 0i-TD}
    \label{fig:fanuc}
\end{figure} 

\begin{figure}[h!]
    \centering
    \includegraphics[width=.7\textwidth]{kse_cnc.jpg}
    \caption[Стойка KSE-TOUCH CNC]
            {Стойка KSE-TOUCH CNC}
    \label{fig:kse}
\end{figure} 

Одним из главных недостатков таких стоек является то, что они располагаются непосредственно рядом с~технологическим оборудованием и~не~обеспечивают возможность удаленного управления. 

Многие производители технологического оборудования, пытаясь решить эту проблему, прилагают программное обеспечение, установив которое на~персональный компьютер, появляется возможность осуществлять удаленное управление. \textls[-30]{Однако с~таким подходом сопряжен {\it ряд проблем}}. 

{\it Во-первых}, обычно поддерживается только ряд известных платформ, что вносит ограничения в~организацию управления оборудованием.

{\it Во-вторых}, технологическое оборудование имеет долгий срок службы, а учитывая скорость развития информационных технологий и~компьютерной техники, такое программное обеспечение придется регулярно обновлять. При этом процесс обновления так или иначе будет требовать определенного набора действий от пользователя, поскольку изменения будут проходить именно на~используемой целевой машине.

{\it В-третьих}, отсутствие мобильности, поскольку оператор все также остается привязан к~определенному рабочему месту.

\textls[-40]{Вместе с~тем, учитывая тенденции развития современных производственных систем, важно не~только обеспечить удаленное управление, но~и~определенный уровень абстракции. Это позволило бы незаметно для нижнего уровня осуществлять управление и~наблюдение как с~помощью оператора, так и~с~использованием другой программной системы более высокого порядка.}

Сейчас \textbf{\textit{ функции пользовательского интерфейса}} обычно подразделяются на~{\it пять групп}~\cite{theory_of_cnc}:
\begin{enumerate}
\item {\it Операционные функции}. \textls[-40]{Они используются часто и~помогают управлять технологическим оборудованием, а также показывают его состояние. Они занимаются отображением позиции, расстояния, подачи по каждой оси, скорости шпинделя, выполняемого блока программы и~статуса. Кроме того, предусмотрены функции, помогающие работать с~технологическим оборудованием, такие как перемещение в~режимах Jog\footnote{Jog -- режим, который может быть использован для перемещения по заданной оси с~заданной скоростью.} и~MDI\footnote{MDI\,(Manual data input) -- режим ввода команды (например, G-код) для прямого выполнения.}, поиск программ, редактор программ и~управление инструментами.}
\item {\it Функции настройки параметров}. В системе ЧПУ имеются различные параметры для внутреннего использования, которые подразделяются на~три вида: 
	\begin{itemize}
	\item  параметры станка, которые используются для настройки станка, сервопривода, смещения инструмента, рабочей 	координаты;
	\item параметры программы, которые должны быть установлены при редактировании программы обработки детали;
	\item параметры настройки, которые используются, чтобы адаптировать машину к~требованиям пользователя.
	\end{itemize}  
Эти функции предоставляют интерфейс для установки, хранения и~поиска параметров.
\item {\it Функции редактирования программы.} Эти функции позволяют редактировать и~модифицировать программу обработки детали, которая представляет собой G-код.
\item {\it Функции контроля и~сигнализации.} Система ЧПУ всегда уведомляет пользователя о состоянии и, при необходимости, запускает на~исполнение важные задачи и~информирует пользователя о результате. Функции сигнализации  оповещают о сигнале тревоги, методе аварийного восстановления~и~т.д.
\item {\it Служебные функции.} Помимо других четырех основных функций, для оказания помощи пользователям предоставляется множество полезных функций. Например, осуществление сетевого взаимодействия и~управление данными пользователя.
\end{enumerate}
%Далее приведен минимальный {\it набор функций}, которые должны выполняться пользовательским графическим интерфейсом системы управления технологическим оборудованием:
%\begin{itemize}
%\item визуализация процесса обработки;
%\item обеспечение управления рабочими органами технологического оборудования;
%\item управление данными системы;
%\item осуществление сетевого взаимодействия;
%\item ввод управляющих программ.
%\end{itemize}

Графический интерфейс в~первую очередь предоставляет широкий набор возможностей по визуализации процесса обработки. Визуализация процесса обработки является важной, поскольку дает возможность пользователю оборудования определить состояние и~этап процесса обработки в~реальном времени. В технологическом оборудовании визуализация обычно осуществляется несколькими способами:
\begin{itemize}
\item Экран, отображающий проделанный путь рабочей головки. Он позволяет визуально оценить получаемый результат. Особенно полезен в~случаях, когда нет возможности осмотра происходящей обработки с~камер или в~реальности, например лазерная обработка или сварка.
\item Экран с~управляющей программой и~выделенной текущей строкой, позволяет ответить на~вопросы: <<какое действие сейчас выполняется?>> и~<<какая часть работ уже выполнена?>>.
\item Набор экранов, отображающих текущие координаты рабочей головки, текущие настройки, инструмент, скорости~и~т.д.
\item Экран видеонаблюдения. Применяется, когда оборудование оснащено камерами, обычно когда нет прямого доступа для наблюдения рабочей области.
\item Экран с~3D-моделью выполняемого процесса в~реальном времени.
\end{itemize}

Из всего вышесказанного следует, что графическая часть пользовательского интерфейса позволяет наиболее полно и~наглядно обеспечивать связь технологического оборудования с~пользователем, используя современные технологии, например, 3D-моделирование и~работу с~видео.
%В контексте современного интеллектуального производства этот набор может быть расширен множеством дополнительных возможностей, например, удаленным сервисным доступом, управлением данными пользователей и~их~правами доступа.

%Одним из очевидных примеров, может быть система мониторинга оборудования. Реализация которой сейчас является сложной и~дорогостоящей задачей. Однако наличие уровня абстракции позволило бы строить систему мониторинга по принципу агрегатора элементов наблюдения (а~не~состояний напрямую) со всего технологического оборудования. Это означает, что для создания системы мониторинга потребовалось бы решить только задачу агрегации и~компановки, не~задумываясь о способах сбора и~отображния данных.

%В качестве еще одного примера, можно привести ситуацию, когда производственный процесс строится по принципу <<переговоров>> участников производственного процесса. Для осуществления такого подхода система управления конкретного технологического оборудования должна быть расширена системой планирования. Одним из вариантов реализации такой системы может быть реализация над модулем пользовательского интерфейса. Это означает, что данная система использовала бы те же самые интерфейсы, которыми пользуется оператор, но~без их~графической составляющей, например интерфейсом загрузки управляющей программы.

\section{Инструменты разработки графического интерфейса}
Инструменты разработки графического интерфейса делятся на~три основные категории:
\begin{itemize}
\item Низкоуровневые фреймворки.
\item Высокоуровневые фреймворки.
\item Фреймворки для разработки интерфейса веб-приложений.
\end{itemize}

\textit{\textbf{ Низкоуровневые фреймворки}} решают задачи отрисовки окон, движения окон, взаимодействие с~клавиатурой и~мышью. В~зависимости от~типа операционной системы они либо интегрированы в~операционную систему, либо работают поверх неё. Разработчики графических интерфейсов редко работают с~ними напрямую и~используют высокоуровневые фреймворки для решения своих задач. Однако необходимо понимать, что базой любого графического интерфейса являются именно такие низкоуровневые компоненты. В~качестве примеров можно привести Cocoa, Windows API и~X~Window~System.

\textit{\textbf{Высокоуровневые фреймворки}} решают задачи, связанные непосредственно с~разработкой приложений с~графическим интерфейсом, они включают в~себя наборы примитивов графического интерфейса, инструменты для работы с~ними и~некоторые дополнительные возможности. Высокоуровневые фреймворки разделяются~на:
\begin{itemize}
\item платформо-зависимые;
\item кроссплатформенные.
\end{itemize}

\textit{Платформо-зависимые фреймворки} позволяют создавать приложения с~графическим интерфейсом, которые поддерживаются только определенной операционной системой. Несмотря на~этот недостаток, можно выделить ряд плюсов таких фреймворков. Во-первых, использование нативного кода, а~соответственно доступ ко~всем возможностям операционной системы и~в~теории ускорение работы. Во-вторых, соответствие элементов графического интерфейса стилевым темам, установленным разработчиками операционной системы. Примерами таких фреймворков являются MacApp, Microsoft Foundation Classes~и~MUI.

\textit{Кроссплатфоременные фреймворки} позволяют создавать программы с графическим интерфейсом под множество платформ без изменения программного кода. Многие из них позволяют автоматически изменять вид элементов графического интерфейса в зависимости от платформы, а также кастомизировать их внешний вид во время разработки. Одними из самых популярных являются  фреймворки Qt и GTK+.

Тем не менее, сейчас для создания приложений с графическим интерфейсом все чаще используются веб-технологии. Главными причинами являются не только широкие возможности создания собственных элементов и виджетов со сложной логикой, но и распространение сетей повсеместно. Использование веб-технологий при создании интерфейсов позволяет обеспечить удаленный доступ, мобильность, мультиплатформенность и экономию ресурсов пользователя.

В настоящее время имеется значительное количество разнообразных \textit{\textbf{фреймворков для разработки интерфейса веб-приложений}}. Однако в действительности все они сводятся к использованию стандартного стека технологий HTML/CSS/JS. Данные фреймворки можно поделить на три вида:
\begin{itemize}
\item фреймворки, работающие по принципу конструктора;
\item JS-фреймворки;
\item Специальные языки программирования, компилирующиеся в JS. 
\end{itemize}

\textit{\textbf{Bootstrap}} является самым широко используемым фреймворком, работающим по принципу конструктора. Он состоит из набора готовых стилизованных шаблонов оформления, зачастую инкапсулирующих определенную логику. Более того, он включает в себя разнообразные инструменты создания элементов навигации, медиа-контейнеры, таблицы, сетки и типографику. Подключение осуществляется через базовый html-файл так, как показано на \autoref{lst:bootstrap}.

{\singlespacing
\begin{lstlisting}[showstringspaces=false,basicstyle=\ttfamily,frame=tb,
    numbers=left,numberstyle=\tiny,numbersep=5pt,label={lst:bootstrap},
    caption={Подключение фреймворка Bootstrap}]
<link href="{{ url_for('static', 
               filename='dist/css/bootstrap.min.css')
             }}" rel="stylesheet">
<script src="{{url_for('static', 
               filename = 'dist/js/bootstrap.min.js')
              }}">
</script>
\end{lstlisting}
}

\textit{\textbf{ReactJS}} является известным представителем JS-фреймворков. Данный фреймворк работает  на уровне представления и результатом его работы является HTML. Т.е. фреймворк не занимается описанием внешнего вида элементов, он осуществляет управление отрисовкой, а также позволяет создавать связки HTML-JS. Вместо разделения функциональности и представления ReactJS позволяет создать набор компонентов. Создание компонентов происходит на языке JSX, который затем компилируется в JS. Подключение ReactJS указано в~\autoref{lst:react}.

{\singlespacing
\begin{lstlisting}[showstringspaces=false,basicstyle=\ttfamily,frame=tb,
    numbers=left,numberstyle=\tiny,numbersep=5pt,label={lst:react},
    caption={Подключение ReactJS}]
<script src="http://fb.me/react-0.10.0.min.js">
</script>
\end{lstlisting}
}

Язык \textit{\textbf{Elm}} представитель множества языков, которые компилируются в JS, HTML и CSS. Он является функциональным и позволяет создавать графический интерфейс веб-приложений в функциональной парадигме. Elm обладает собственной экосистемой, включающей компилятор, пакетный менеджер и систему сборки.
\section{Структурно-модульный подход к~разработке графического интерфейса}
\subsection[{\textls[-20]{Требования к разработке графического интерфейса}}]{Требования к разработке графического интерфейса}
Очевидно, что монолитный подход к~разработке графического интерфейса неприемлем для модульной системы управления технологическим оборудованием. Причиной является появление динамической составляющей графического интерфейса. Динамическая составляющая означает, что наборы виджетов, предоставляемых пользователю, должны меняться и~расширяться в~зависимости от модулей (микросервисов), доступных в~распределенной сети системы~ЧПУ. 

Кроме того, учитывая современные тенденции развития промышленности, выдвигается {\it ряд требований}:
\begin{enumerate}
\item {\it Обеспечить удаленный доступ} к~управляемому технологическому оборудованию, учитывая мобильность и~мультплатформенность.
\item {\it Обеспечить конфигурируемость и расширяемость}, т.е.~возможность динамически дополнять и~заменять элементы пользовательского интерфейса в~зависимости от~установленного модуля или желания пользователя.
\item {\it Обеспечить безопасность}, в~том числе, разграничение доступа для пользователей и~других сервисов.
\item {\it Обеспечить интероперабельность}, т.е.~использование открытого протокола. В~качестве примера, можно привести ситуацию, когда производственный процесс строится по~принципу <<переговоров>> участников производственного процесса. Для осуществления такого подхода система управления конкретного технологического оборудования должна быть расширена системой планирования. Одним из~вариантов реализации такой системы может быть реализация над модулем пользовательского интерфейса с использованием открытого протокола. Это означает, что данная система использовала бы~те~же~интерфейсы, которыми пользуется оператор, но~без их~графической составляющей, например интерфейсом загрузки управляющей программы.
\end{enumerate}

Учитывая вышеприведенные требования, предлагается использование структурно-модульного подхода.	

\subsection{Описание структурно-модульного подхода}
Структурно-модульный подход~--~это гибридный подход, сочетающий в~себе принципы как структурного, так и~модульного подходов к~разработке. Понятие модульного подхода появилось достаточно давно и~сейчас лежит в~основе многих других подходов. \textit{К~основным принципам \textbf{модульного подхода}} относятся следующие~\cite{modappr}:
\begin{itemize}
\item {\it Принцип изоляции определяемого понятия.} Модуль представляет собой чёрный ящик, инкапсулируя~в себе определенное понятие и~его реализацию.
\item {\it Принцип создания проблемно-ориентированного контекста.} Благодаря декомпозиции на~модули разработчик может частично формализовать проблемную часть предметной области. За~счет этого получается чётко сформулировать перечень задач, решаемых конкретной системой.
\item {\it Принцип заменяемости и~локализации машинной зависимости программ.} Модульность позволяет системе быть реконфигурируемой и~изменяемой, заменяя части системы без влияния на~неё в~целом. Это в~свою очередь влечет аппаратную независимость программной системы.
\item {\it Принцип представления модуля как абстрактного объекта.} Данный принцип позволяет определить некоторую семантику на~определенном уровне абстракции независимо от~используемого алгоритма, типа данных, способа работы с~памятью и~т.д.~Фактически, это один из~главных принципов, который затем лёг в~основу объектно-ориентированного подхода.
\item {\it Принцип поэтапной и параллельной разработки программ.} Обычно разработка программ включает в~себя несколько этапов~\cite{stages}: анализ требований к~проекту, проектирование, реализация, тестирование продукта, внедрение и~поддержка. Под принципом поэтапной разработки понимается соответствие каждому этапу степени детализации описания модуля. При этом модули могут создаваться разными разработчиками параллельно. 
\end{itemize}

\textit{\textbf{Структурный подход}} \textls[-20]{базируется на основе проектирования <<сверху} в низ>>, используя декомпозицию, но при этом сохраняя целостность системы. Такой подход строится на следующих принципах~\cite{structappr}:
\begin{itemize}
\item {\it Принцип <<разделяй и~властвуй>>.} Принцип, согласно которому для решения задачи производится ее~деление на~более мелкие до~того момента, пока задачи не~станут элементарными. А затем, на~основе решений мелких задач, приходят к решению главной.
\item {\it Принцип иерархического упорядочивания.} Данный принцип указывает, что организация системы должна быть уровневой (или послойной).
\item {\it Принцип абстрагирования.} Принцип подразумевает отделение наиболее важных аспектов системы на~определенном уровне от~менее важных с~целью последовательной детализации функций системы.
\item{\it Принцип непротиворечивости.} Заключается в~поддержании согласованности элементов программной системы.
\item{\it Принцип структурирования и независимости данных.} Данные должны быть структурированы, а~также не~должны зависеть от~способа их~передачи и~обработки.
\end{itemize}

В~результате комбинации двух вышеуказанных подходов был получен \textit{\textbf{структурно-модульный подход}}. Как можно заметить, модульный подход отличается обособленностью частей программного обеспечения друг от~друга, которые были получены посредством декомпозиции. В~то~время как структурный подход наоборот определяет строгие иерархические связи между ними. Вместе с этим, главная идея структурно-модульный подхода~--~динамическое образование структур из модулей. 

С одной стороны, производится декомпозиция на отдельные независимые друг от~друга модули. При этом полученные модули соответствуют всем принципам модульного подхода, однако дополнительно добавляется принцип интероперабельности. Что означает, что данные модули должны иметь возможность коммуникации в~распределенной сети по~открытому интерфейсу. Открытым интерфейсом называется такой способ взаимодействия, который могли бы~использовать любые модули вне зависимости от~расположения, внутренних особенностей реализации и~языка, на~котором они~написаны.

С~другой стороны, дополнительно реализуется агрегатор\,(\autoref{fig:scheme}). Данный компонент, используя открытый интерфейс модулей, динамически объединяет их~в~структуры. Вместо системы с~плоской организацией создается система с~иерархической организацией\,(\autoref{fig:struct}). \textls[-35]{Тем не~менее, в~данном подходе иерархия не~является жесткой, она динамически адаптируется и~изменяется в~зависимости от~задач и~потребностей вышестоящего уровня.}\looseness=-1

\begin{figure}[h!]
    \centering
    \def\svgwidth{.9\textwidth}
    \input{scheme.eps_tex}
    \caption[Агрегатор]
            {Агрегатор}
    \label{fig:scheme}
\end{figure}

\begin{figure}[h!]
    \centering
    \includegraphics[width=.9\textwidth]{struct.png}
    \caption[Структура системы с иерархической организацией]
            {Структура системы с иерархической организацией}
    \label{fig:struct}
\end{figure}

\subsection[Графический интерфейс системы ЧПУ на~основе структурно-модульного подхода]{Графический интерфейс модульной системы ЧПУ на~основе структурно-модульного подхода}
Система управления модульным технологическим оборудованием представляет собой гетерогенную распределенную сеть, узлами которой являются разнообразные модули системы, как программные, так и программно-аппаратные\,(\autoref{fig:mcnc}). 

\begin{figure}[h!]
    \centering
    \includegraphics[width=.9\textwidth]{modern_cnc.png}
    \caption[Составляющие модульного оборудование с ЧПУ]
            {Составляющие модульного оборудование с ЧПУ}
    \label{fig:mcnc}
\end{figure}

Таким образом, при создании компонента графического интерфейса необходимо учитывать возможность замены одного модуля системы другим. Чтобы реализовать это, необходимо применить структурно-модульный подход.

Очевидно, что первичная декомпозиция графического интерфейса на~модули соответствует перечню аппаратных модулей системы. При этом каждый такой модуль графического интерфейса~(модуль~ГИ)~--~самостоятельная автономная программная единица, которая находится на~соответствующей аппаратной платформе и~обладает свойством интероперабельности. Дальнейшая декомпозиция производится по~функциям конкретного модуля системы, образуя набор виджетов\,(\autoref{fig:guiappr}). Виджеты для локального модуля графического интерфейса выступают в~качестве данных и~передаются другим участника сети по~запросу.

\begin{figure}[h!]
    \centering
    \def\svgwidth{1.1\textwidth}
    \input{guiappr.eps_tex}
    \caption[Организация компонента графического интерфейса]
            {Организация компонента графического интерфейса}
    \label{fig:guiappr}
\end{figure}

Для образования вр\'еменной структуры используется агрегатор интерфейсов. Полученные модули графического интерфейса он~компонует в~базовую оболочку системы управления, где такая иерархия описывается корневым html-файлом. Графические интерфейсы каждого модуля также встраиваются в~этот корневой файл. В~данном корневом файле графические интерфейсы распределены по~категориям и~доступны для пользователя. Сама структура может меняться в~двух случаях:
\begin{itemize}
\item Во-первых, автоматически, в~случае, если был заменен программно-аппаратный модуль системы ЧПУ.
\item Во-вторых, в~ручную, когда пользователь самостоятельно выбрал необходимый набор графических форм под текущую задачу. Данную возможность должна обеспечивать базовая оболочка.
\end{itemize}

Из~вышесказанного становится ясно, что агрегатор должен быть реализован в~виде веб-сервера. Такой подход позволяет удовлетворить требование обеспечения удаленного доступа и~мультиплатформенности. А~также позволяет решить проблемы безопасности, используя стандартные способы, применяемые при веб-разработке.
\section[Протокол взаимодействия пользовательского графического интерфейса]{Протокол взаимодействия пользовательского графического интерфейса
}
Микросервисная архитектура модульной системы управления предполагает применение общего облегченного протокола взаимодействия, позволяющего скрыть особенности реализации модулей. Так как модуль пользовательского графического интерфейса является частью децентрализованной гетерогенной сети, необходимо использовать <<умные>> приемники сообщений и~<<глупые каналы>> передачи данных. Подобное решение дает возможность делать модули системы максимально независимыми и~сфокусированными на~решении одной конкретной задачи.

Очевидно, что при работе в~сетях TCP/IP, наиболее очевидным способом передачи данных являются <<сырые>> сокеты. Через этот программный интерфейс можно передавать байтовый поток данных. Но в~разрабатываемой системе все модули, в~том числе и~модуль пользовательского графического интерфейса, обмениваются уже структурированной информацией. Поэтому более правильным подходом будет использование разновидности пакетной передачи данных. Каждый пакет – есть некоторое сообщение, которое может быть передано от одного модуля к~другому. Получив данное сообщение, принимающий модуль должен подтвердить получение (в случае, если его содержимое ему понятно и~может быть обработано) либо отклонить сообщение.

Легко заметить, что подобные сообщения очень похожи на~те, которые используются в~таких протоколах как XML-RPC, SOAP, BPEL или WSDL, но~с одним важным отличием. Все эти протоколы используются в~крупных промышленных приложениях и~явно не~подходят для встраиваемых систем. А так как модуль графического интерфейса должен осуществлять взаимодействие и~со встраиваемыми системами, то данный недостаток является существенным. Для создания легковесной, открытой и~расширяемой системы управления необходимо минимизировать слой абстракции, максимально используя преимущества низкоуровневых сокетов в~сочетании с~возможностью осуществлять маршрутизацию сообщений. 

Таким образом, наиболее подходящим способом взаимодействиями модулей проектируемой системы числового программного управления являются \textbf{\textit{очереди сообщений}}.

Очередь сообщений является асинхронным протоколом передачи данных, то есть отправитель и~получатель сообщения не~взаимодействуют друг с~другом напрямую, а только через очередь.

Можно выделить следующие \textbf{\textit{основные особенности очередей сообщений}}, которые позволяют сделать вывод о том, что для проектируемой системы управления данный способ передачи данных является наиболее целесообразным:
\begin{itemize}
\item Очереди сообщений позволяют компонентам системы оставаться максимально независимыми друг от друга, исключая возможные взаимные блокировки, когда один из участников взаимодействия вынужден ожидать освобождения сетевых ресурсов, необходимых ему для передачи или приема данных.
\item Очереди сообщений дают возможность экономить вычислительные ресурсы за счет отсутствия необходимости в~сетевых буферах, в~которых хранятся еще не~переданные или еще необработанные данные. По сути, очередь сообщений сама является универсальным сетевым буфером, не~привязанным к~какому-то конкретному узлу или процессу. 
\item Очереди сообщений легко масштабируются как по объему передаваемых данных, так и~по пропускной способности.
\item Очереди сообщений позволяют легко сглаживать пиковые нагрузки, возникающие в~сети. Для проектируемой системы управления это особенно важно, так как в~ней возможно смешение разных типов трафика. В частности, можно выделить как минимум высокоприоритетный трафик (данные от датчиков, команды управления) и~низкоприоритетный трафик (загрузка исходного текста программы управления в~контроллер, передача видео из зоны обработки~и~т.д.).
\item Очереди сообщений позволяют существенно повысить отказоустойчивость системы, ведь сообщения остаются в~очереди и~могут быть обработаны даже в~случае отказа отправившего их~узла. Это можно продемонстрировать на~примере передачи управления управляющей программы для оборудования с~ЧПУ. Управляющая программа создается оператором в~блоке интерфейса, а затем передается в~блок исполнения в~виде потока текстовых команд. Очевидно, что программа будет передана в~виде нескольких сообщений, помещаемых в~очередь, причем на~максимально возможной скорости. Предположим, что какой-то момент блок интерфейса <<зависает>>, данный факт фиксируется сторожевым таймером, который инициирует перезагрузку операционной системы. Однако во время перезагрузки блок исполнения продолжает считывать и~обрабатывать сообщения из очереди, и~для него процесс передачи данных не~прерывается.
\item Очереди сообщений гарантируют доставку сообщения, по крайней мере до тех пор, пока в~сети функционирует хотя бы один узел, который может обработать их.
\item Очереди сообщений не~нарушают порядок передаваемых сообщений. Как правило, сообщения будут получены именно в~том порядке, в~котором они были отправлены.
\end{itemize}

%Добавить сюда еще что-нибудь

\section{Отображение модуля графического интерфейса на~эталонную модель RAMI~4.0 }
Индустрия~4.0 включает в~себя множество аспектов, и~для того, чтобы определить общее виденье этих аспектов и~их связь, была создана эталонную модель RAMI~4.0 (\autoref{fig:rami}). Данная модель является иерархической и трехмерной, и~по трём осям отображает предметную область с~точки зрения информационных технологий, жизненного цикла изделий и~организации производства.

\begin{figure}[h!]
    \centering
    \includegraphics[width=.9\textwidth]{rami.jpg}
    \caption[Архитектурная модель RAMI 4.0]
            {Архитектурная модель RAMI 4.0}
    \label{fig:rami}
\end{figure} 
В~сфере информационных технологий использование таких типов моделей не~редкость. Известный пример -- иерархическая семиуровневая модель OSI~\cite{osi}, которая является эталонной моделью протоколов взаимодействия. Использование таких моделей позволяет достичь четкого понимания функций каждого уровня, а также определить интерфейсы связи между ними.
	
\textls[-20]{Одна из основных задач данной модели -- обеспечить простое, наглядное и~структурированное представление, которое бы помогало при создании описания компонентов и~локализировало бы их~роль в~предметной области.}

Таким образом, для того чтобы обосновать применение структурно-модульного подхода к~реализации графических интерфейсов, далее будет представлено отображение на~архитектурную модель RAMI 4.0 модуля пользовательского графического интерфейса, разработанного с~использованием вышеуказанного подхода.

Модуль графического интерфейса входит в~состав системы управления технологическим оборудованием, поэтому на~правой горизонтальной оси он находится в~областях \textit{<<устройство управления>> и~<<станция>>}. Модуль не входит в область <<полевые устройства>>, поскольку не~имеет связи с~ними напрямую.

Наибольший интерес в~данном случае представляет вертикальная ось. Модуль графического интерфейса находится на~уровнях \textit{<<интеграция>>, <<взаимодействие>>, <<информация>> и <<функционал>>}. Вместе с~этим, он~обеспечивает открытые связи с~вышестоящим и~нижестоящим уровнем. 

\textbf{\textit{Уровень интеграции.}} Цель данного уровня~--~преобразование событий реального мира в~события виртуального мира. На~этом уровне рассматриваемый модуль обеспечивает преобразование действий пользователя (нажатие на~кнопки, ввод программы и~т.д.)~в~события в~виртуальном мире. При этом пользователь находится на нижестоящем уровне~--~уровне ресурсов. \textls[-20]{Фактически, интеграцией занимается клиентская часть рассматриваемого модуля~--~т.е.~браузер и~JavaScript обработчики событий, активирующиеся при взаимодействии пользователя с~графическими формами.}

С~другой стороны, модуль графического интерфейса входит в распределенную гетерогенную сеть системы управления технологическим оборудованием. Поэтому преобразование происходит и~в~обратную сторону. Например, сигнал окончания обработки передается на~модуль графического интерфейса, а тот в~свою очередь извещает об~этом пользователя.

\textbf{\textit{Уровень взаимодействия.}} Целью уровня взаимодействия является определение способа коммуникации, т.е.~интерфейса соединения, протокола и~формата данных, а~также обеспечение связи уровня интеграции и~информационного уровня. Рассматриваемый модуль имеет несколько интерфейсов соединения~--~беспроводное WiFi соединение, Ethernet и~последовательное соединение через UART. В качестве протокола используются очереди сообщений, реализованные с помощью библиотеки \textit{nanomsg}. Очереди построены поверх разных протоколов, например, со~стороны клиента поверх протокола websocket. В~качестве формата передаваемых данных используется бинарный формат \textit{cbor}.

\textbf{\textit{Уровень информации.}} На данном уровне определяются данные, с которыми работает система, способы их хранения, описание событий и их предварительная обработка. В модуле графического интерфейса на этапе инициализации в качестве данных выступают статические файлы, которые передаются от других модулей системы управления. К статическим файлам относятся:
\begin{itemize}
\item html файлы, описывающие структуру графического интерфейса;
\item css файлы, описывающие внешний вид графического интерфейса;
\item js файлы, описывающие логику работы графического интерфейса.
\end{itemize}

Для хранения данных модуль графического интерфейса использует базу данных UnQLite~\cite{unqlite}. Данная система является NoSQL\footnote{NoSQL -- подход к реализации хранилищ данных, где доступ к данным осуществляется без использования языка SQL.} базой данных, основная особенность которой~--~отсутствие сервера. В~отличие от~таких известных NoSql движков как MongoDB\footnote{MongoDB -- документо-ориентированная СУБД, использующая документы, основанные на~формате JSON.}, Redis\footnote{Redis -- сетевое хранилище типа <<ключ-значение>>, осуществляющее хранение в оперативной памяти.}, CouchDB\footnote{ CouchDB -- документо-ориентированная СУБД, написанная на Erlang.}, UnQLite не~требует установки или настройки, а~также не~запускает отдельного процесса для доступа к данным.  Все данные хранятся в~виде одного файла с~сериализованными по~стандарту JSON данными. В~остальном, UnQLite является хранилищем пар <<ключ-значение>>, с~поддержкой курсоров и~возможностью хранить данные как на~диске, так и~в~оперативной памяти. В~дополнение к~этому, UnQLite может работать и~как хранилище документов и~поддерживает транзакции. 

После этапа инициализации модуль работает с~данными, вводимыми пользователями, например,  G-код программами, Gerber файлами и~т.д.

\textbf{\textit{Уровень функционала.}} На~данном уровне определяется перечень функций, которые предлагаются для использования извне, и~платформа для их~предоставления. 

Фактически, сам по~себе модуль графического интерфейса не~обладает функционалом, доступным для других участников, за~исключением удаленного доступа. Однако данный модуль является платформой, которую используют участники гетерогенной сети системы управления технологическим оборудованием для того, чтобы предоставить возможность воспользоваться своими функциями. 

Учитывая вышесказанное, очевидно, что модуль графического интерфейса занимает вполне определенную нишу в RAMI~4.0 и~при этом следует определенной в~RAMI~4.0 иерархии уровней. Таким образом, можно сделать вывод о~том, что на~базе данного модуля можно с~успехом построить компонент Индустрии~4.0.
\section{Выводы к второй главе}
\begin{enumerate}
\item Пользовательский интерфейс оборудования с~ЧПУ имеет множество функций, в~том числе связанных с~визуализацией. Для их~более эффективной реализации необходимо применять графический интерфейс, использующий все возможности веб-технологий.
\item В~настоящее время существует значительное количество инструментов разработки пользовательского графического интерфейса. Чтобы идти в~ногу со~временем и~удовлетворять требованиям четвертой промышленной революции, необходимо использовать инструменты, поддерживающие веб-технологии.
\item Текущие подходы к~реализации пользовательского графического интерфейса в~модульных системах управления технологическим оборудованием влекут за~собой ряд проблем. Структурно-модульный подход предлагает один из~вариантов их~решения.
\item Благодаря проведенному отображению модуля графического интерфейса на эталонную модель RAMI~4.0 было доказано, что модуль занимает вполне определенную нишу в RAMI~4.0 и~при этом следует указанной в~RAMI~4.0 иерархии уровней. Таким образом, можно сделать вывод о~том, что на~базе данного модуля можно с~успехом построить компонент Индустрии~4.0. Данный факт полностью обосновывает применение предложенного подхода к разработке графического интерфейса.
\end{enumerate}